
name: Flutter Android CI

# â”€â”€ What is this file? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# This is a CI (Continuous Integration) pipeline. Every time you push
# code to the "main" branch, GitHub automatically runs all the steps
# below on a cloud server. Think of it as a robot that checks your
# homework before the teacher (your users) sees it.
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€ Triggers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# The pipeline starts automatically when any of these events happen:
on:
  push:
    branches: [main]          # Code merged / pushed to the main branch
  pull_request:
    branches: [main]          # A pull request targeting main
  workflow_dispatch:            # Manual "Run workflow" button in GitHub UI

# â”€â”€ Jobs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:
  build:
    name: "ğŸš€ Build & Test (Android Debug)"
    runs-on: ubuntu-latest      # Free Linux VM provided by GitHub

    steps:
      # ================================================================
      #  SETUP â€” Prepare the cloud machine with the tools we need
      # ================================================================

      - name: "ğŸ“¥ Step 1 â€” Checkout code from repository"
        uses: actions/checkout@v4
        # Downloads your project files onto the cloud machine.
        # Without this, the machine has nothing to work with.

      - name: "â˜• Step 2 â€” Install Java 17 (needed by Android build system)"
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
        # Android apps are built using Gradle, which requires Java.
        # We install Java 17 (long-term support version).

      - name: "ğŸ’™ Step 3 â€” Install Flutter SDK (stable channel)"
        uses: subosito/flutter-action@v2
        with:
          channel: stable
        # Downloads and configures the Flutter SDK so we can use
        # commands like flutter build, flutter test, etc.

      # ================================================================
      #  QUALITY GATES â€” Each step must pass before the next one runs.
      #  If any gate fails, the pipeline STOPS. This is fail-fast.
      # ================================================================

      # â”€â”€ Gate 1: Fetch dependencies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ“¦ Gate 1 â€” Fetch dependencies (flutter pub get)"
        run: |
          echo "=================================================="
          echo "  GATE 1: FETCH DEPENDENCIES"
          echo "=================================================="
          echo ""
          echo "  Reading pubspec.yaml and downloading all packages"
          echo "  the app needs (like cupertino_icons, flutter_lints)."
          echo "  If this fails â†’ a package name is wrong or a"
          echo "  version conflict exists."
          echo ""
          flutter pub get
          echo ""
          echo "âœ… All dependencies fetched successfully."

      # â”€â”€ Gate 2: Formatting check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ¨ Gate 2 â€” Check code formatting"
        run: |
          echo "=================================================="
          echo "  GATE 2: CODE FORMATTING CHECK"
          echo "=================================================="
          echo ""
          echo "  Checking that every .dart file follows the"
          echo "  standard Dart formatting style."
          echo "  This does NOT change files â€” it only reports."
          echo "  If this fails â†’ run 'dart format .' locally."
          echo ""
          dart format --output=none --set-exit-if-changed .
          echo ""
          echo "âœ… All files are properly formatted."

      # â”€â”€ Gate 3: Static analysis â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ” Gate 3 â€” Static analysis (lint check)"
        run: |
          echo "=================================================="
          echo "  GATE 3: STATIC ANALYSIS (LINTING)"
          echo "=================================================="
          echo ""
          echo "  Scanning all Dart code for:"
          echo "    - Unused imports"
          echo "    - Undefined variables"
          echo "    - Type mismatches"
          echo "    - Style violations (from analysis_options.yaml)"
          echo ""
          echo "  This also checks the AI prediction code in"
          echo "  lib/main.dart for correctness â€” weighted moving"
          echo "  average logic, timer handling, null safety, etc."
          echo ""
          flutter analyze --fatal-infos
          echo ""
          echo "âœ… No analysis issues found. Code is clean."

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      #  ğŸ§  AI FEATURE TESTS
      #  The following gates specifically validate the AI tap-prediction
      #  feature. The AI uses a weighted moving average algorithm to
      #  predict when the user will tap next, based on their tap history.
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      # â”€â”€ Gate 4a: Core counter test â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ§ª Gate 4a â€” Test: Counter increments correctly"
        run: |
          echo "=================================================="
          echo "  GATE 4a: CORE COUNTER TEST"
          echo "=================================================="
          echo ""
          echo "  Test: 'Counter increments smoke test'"
          echo "  What it does:"
          echo "    1. Launches the app in memory (no phone needed)"
          echo "    2. Verifies the counter starts at 0"
          echo "    3. Simulates tapping the + button"
          echo "    4. Verifies the counter is now 1"
          echo ""
          echo "  This is the foundation â€” if the counter doesn't"
          echo "  work, the AI prediction has nothing to predict."
          echo ""
          flutter test --plain-name "Counter increments smoke test"
          echo ""
          echo "âœ… Counter works correctly (0 â†’ 1 on tap)."

      # â”€â”€ Gate 4b: AI learning phase test â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ§  Gate 4b â€” Test: AI learning phase (< 5 taps)"
        run: |
          echo "=================================================="
          echo "  GATE 4b: AI LEARNING PHASE TEST"
          echo "=================================================="
          echo ""
          echo "  Test: 'AI prediction shows learning state before 5 taps'"
          echo ""
          echo "  HOW THE AI WORKS (learning phase):"
          echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "  â”‚ The AI needs at least 5 taps to start        â”‚"
          echo "  â”‚ predicting. Before that, it shows:           â”‚"
          echo "  â”‚                                              â”‚"
          echo "  â”‚   ğŸ§  AI is learning...                       â”‚"
          echo "  â”‚   Tap 5 more times to activate prediction    â”‚"
          echo "  â”‚                                              â”‚"
          echo "  â”‚ Each tap reduces the count:                  â”‚"
          echo "  â”‚   Tap 1 â†’ '4 more times'                    â”‚"
          echo "  â”‚   Tap 2 â†’ '3 more times'                    â”‚"
          echo "  â”‚   Tap 3 â†’ '2 more times'                    â”‚"
          echo "  â”‚   Tap 4 â†’ '1 more time'                     â”‚"
          echo "  â”‚   Tap 5 â†’ AI activates! (see Gate 4c)       â”‚"
          echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          echo ""
          echo "  What the test verifies:"
          echo "    1. Before any tap â†’ shows 'AI is learning'"
          echo "    2. After 1 tap â†’ shows '4 more times'"
          echo "    3. After 2 taps â†’ shows '3 more times'"
          echo ""
          flutter test --plain-name "AI prediction shows learning state before 5 taps"
          echo ""
          echo "âœ… AI correctly shows learning state and countdown."

      # â”€â”€ Gate 4c: AI prediction activation test â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ¤– Gate 4c â€” Test: AI prediction activates after 5 taps"
        run: |
          echo "=================================================="
          echo "  GATE 4c: AI PREDICTION ACTIVATION TEST"
          echo "=================================================="
          echo ""
          echo "  Test: 'AI prediction activates after 5 taps'"
          echo ""
          echo "  HOW THE AI WORKS (prediction phase):"
          echo "  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "  â”‚ ALGORITHM: Weighted Moving Average           â”‚"
          echo "  â”‚                                              â”‚"
          echo "  â”‚ After 5+ taps, the AI:                      â”‚"
          echo "  â”‚  1. Calculates time between each tap         â”‚"
          echo "  â”‚  2. Weights recent taps MORE heavily         â”‚"
          echo "  â”‚  3. Predicts when the next tap will happen   â”‚"
          echo "  â”‚  4. Shows a live countdown on screen         â”‚"
          echo "  â”‚                                              â”‚"
          echo "  â”‚ Example:                                     â”‚"
          echo "  â”‚  Tap intervals: 2s, 1.5s, 1s, 0.8s          â”‚"
          echo "  â”‚  Weights:       1,  2,    3,  4              â”‚"
          echo "  â”‚  Prediction = weighted average â‰ˆ 1.1s        â”‚"
          echo "  â”‚                                              â”‚"
          echo "  â”‚ The model adapts: tap faster â†’ prediction    â”‚"
          echo "  â”‚ gets shorter. Tap slower â†’ it adjusts up.    â”‚"
          echo "  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          echo ""
          echo "  What the test verifies:"
          echo "    1. Simulates 5 taps (500ms apart)"
          echo "    2. AI Prediction card appears"
          echo "    3. Counter shows 5"
          echo "    4. Tap history shows '5 taps recorded'"
          echo ""
          flutter test --plain-name "AI prediction activates after 5 taps"
          echo ""
          echo "âœ… AI prediction is active and working correctly."
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  ğŸ‰ ALL AI TESTS PASSED!"
          echo "  The weighted moving average algorithm correctly:"
          echo "    â€¢ Waits for enough data (5 taps minimum)"
          echo "    â€¢ Learns from tap intervals"
          echo "    â€¢ Produces predictions"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # â”€â”€ Gate 5: Build debug APK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ”¨ Gate 5 â€” Build debug APK"
        run: |
          echo "=================================================="
          echo "  GATE 5: BUILD DEBUG APK"
          echo "=================================================="
          echo ""
          echo "  Compiling the Flutter app (with AI prediction"
          echo "  feature) into an installable Android APK."
          echo "  This proves the ENTIRE project compiles on a"
          echo "  clean machine â€” not just on your laptop."
          echo ""
          flutter build apk --debug
          echo ""
          echo "âœ… APK built successfully at:"
          echo "   build/app/outputs/flutter-apk/app-debug.apk"

      # â”€â”€ Gate 6: Upload APK artifact â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ“¤ Gate 6 â€” Upload APK for download"
        uses: actions/upload-artifact@v4
        with:
          name: app-debug-apk
          path: build/app/outputs/flutter-apk/app-debug.apk
        # This makes the APK downloadable from the Actions page.
        # Team members can grab it without any dev setup.
